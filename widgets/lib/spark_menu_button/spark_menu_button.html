<!DOCTYPE html>

<!-- Copyright (c) 2013, Google Inc. Please see the AUTHORS file for details.
     All rights reserved. Use of this source code is governed by a BSD-style
     license that can be found in the LICENSE file. -->

<!--
/**
 * See g-menu-button https://github.com/Polymer/toolkit-ui/tree/master/elements.
 */
-->

<link rel="import" href="../../../packages/spark_widgets/spark_icon_button/spark_icon_button.html"/>
<link rel="import" href="../../../packages/spark_widgets/spark_overlay/spark_overlay.html">
<link rel="import" href="../../../packages/spark_widgets/spark_menu/spark_menu.html"/>

<polymer-element name="spark-menu-button"
    attributes="src,
                selected,
                valueattr,
                opened,
                responsive,
                valign">

  <template>
    <!-- TODO(terry): Need to support link/rel for CSS in templates.-->
    <!--link rel="stylesheet" href="css/spark_menu_button.css"-->
    <style>
      :host {
        display: inline-block;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        width: 44px;
        height: 44px;
      }

      /* TODO(ussuri): Remove the @host block once :host is supported by Dartium */
      @host {
        * {
          display: inline-block;
          box-sizing: border-box;
          -moz-box-sizing: border-box;
          width: 44px;
          height: 44px;
        }
      }

      #overlay {
        background: white;
        border: 1px solid rgba(0, 0, 0, 0.15);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        margin-left: 22px;
        -webkit-transform: translateX(-50%);
        transform: translateX(-50%);
      }

      [valign=right] #overlay {
        -webkit-transform: translateX(-90%);
        transform: translateX(-90%);
      }

      [valign=left] #overlay {
        -webkit-transform: translateX(-10%);
        transform: translateX(-10%);
      }

      .arrow {
        height: 1px;
        width: 0;
        margin: -17px auto 0;
        border-color: transparent transparent #cfcfcf transparent;
        border-style: solid;
        border-width: 8px;
      }

      .arrow-inner {
        border-bottom-color: white;
        margin-top: -15px;
      }

      [valign=right] .arrow {
        position: relative;
        left: -7px;
        margin-left: 90%;
      }

      [valign=left] .arrow {
        position: relative;
        left: -7px;
        margin-left: 10%;
      }

      #overlayMenu {
        display: block;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
      }

      /* TODO(ffu): adding responsive class won't work in native; to work in native
      automatically we'll need to add a feature to detect if we're in a responsive
      container */
      @media screen and (max-width: 800px) {
        [responsive=true] .arrow-border, .arrow {
          display: none;
        }

        [responsive=true] #overlayMenu {
          width: 100%;
        }

        [responsive=true] #overlay  {
          /* override spark-overlay :host rule style */
          position: absolute !important;
          -webkit-transform: translateX(0);
          transform: translateX(0);
          right: 0;
          bottom: 0;
          left: 0;
          margin: 0;
          border-bottom: 0;
          box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.1);
        }

        [responsive=true] #overlay.slideup {
          -webkit-transform: translateY(100%);
          transform: translateY(100%);
          /* override spark-overlay @host rule style */
          -webkit-transition: -webkit-transform 0.218s !important;
          transition: transform 0.218s !important;
        }

        [responsive=true] #overlay.slideup.opened {
          -webkit-transform: translateY(0);
          transform: translateY(0);
        }
      }
    </style>

    <spark-icon-button id="button" touch-action="none" on-click="{{toggle}}"
        src="{{src}}" active="{{opened}}">
    </spark-icon-button>

    <div responsive="{{responsive}}" valign="{{valign}}">
      <spark-overlay id="overlay" class="slideup" opened="{{opened}}" modal
          autoCloseDisabled on-activate="{{toggle}}">
        <div class="arrow"></div>
        <div class="arrow arrow-inner"></div>
        <spark-menu id="overlayMenu"
            selected="{{selected}}"
            valueattr="{{valueattr}}">
          <content select="*"></content>
        </spark-menu>
      </spark-overlay>
    </div>
  </template>

  <script type="application/dart" src="spark_menu_button.dart"></script>
</polymer-element>
